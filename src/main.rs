extern crate maxminddb;

use std::net::IpAddr;
use std::str::FromStr;
use maxminddb::geoip2;
use std::collections::HashMap;

static DB: &'static str = "/usr/local/share/GeoIP/GeoLite2-City.mmdb";

fn flag(name: &str) -> str {
    let mut flags = HashMap::new();
    flags.insert("ğŸ‡¦ğŸ‡¨", "Ascension Island");
    flags.insert("ğŸ‡¦ğŸ‡©", "Andorra");
    flags.insert("ğŸ‡¦ğŸ‡ª", "United Arab Emirates");
    flags.insert("ğŸ‡¦ğŸ‡«", "Afghanistan");
    flags.insert("ğŸ‡¦ğŸ‡¬", "Antigua & Barbuda");
    flags.insert("ğŸ‡¦ğŸ‡®", "Anguilla");
    flags.insert("ğŸ‡¦ğŸ‡±", "Albania");
    flags.insert("ğŸ‡¦ğŸ‡²", "Armenia");
    flags.insert("ğŸ‡¦ğŸ‡´", "Angola");
    flags.insert("ğŸ‡¦ğŸ‡¶", "Antarctica");
    flags.insert("ğŸ‡¦ğŸ‡·", "Argentina");
    flags.insert("ğŸ‡¦ğŸ‡¸", "American Samoa");
    flags.insert("ğŸ‡¦ğŸ‡¹", "Austria");
    flags.insert("ğŸ‡¦ğŸ‡º", "Australia");
    flags.insert("ğŸ‡¦ğŸ‡¼", "Aruba");
    flags.insert("ğŸ‡¦ğŸ‡½", "Ã…land Islands");
    flags.insert("ğŸ‡¦ğŸ‡¿", "Azerbaijan");
    flags.insert("ğŸ‡§ğŸ‡¦", "Bosnia & Herzegovina");
    flags.insert("ğŸ‡§ğŸ‡§", "Barbados");
    flags.insert("ğŸ‡§ğŸ‡©", "Bangladesh");
    flags.insert("ğŸ‡§ğŸ‡ª", "Belgium");
    flags.insert("ğŸ‡§ğŸ‡«", "Burkina Faso");
    flags.insert("ğŸ‡§ğŸ‡¬", "Bulgaria");
    flags.insert("ğŸ‡§ğŸ‡­", "Bahrain");
    flags.insert("ğŸ‡§ğŸ‡®", "Burundi");
    flags.insert("ğŸ‡§ğŸ‡¯", "Benin");
    flags.insert("ğŸ‡§ğŸ‡±", "St. BarthÃ©lemy");
    flags.insert("ğŸ‡§ğŸ‡²", "Bermuda");
    flags.insert("ğŸ‡§ğŸ‡³", "Brunei");
    flags.insert("ğŸ‡§ğŸ‡´", "Bolivia");
    flags.insert("ğŸ‡§ğŸ‡¶", "Caribbean Netherlands");
    flags.insert("ğŸ‡§ğŸ‡·", "Brazil");
    flags.insert("ğŸ‡§ğŸ‡¸", "Bahamas");
    flags.insert("ğŸ‡§ğŸ‡¹", "Bhutan");
    flags.insert("ğŸ‡§ğŸ‡»", "Bouvet Island");
    flags.insert("ğŸ‡§ğŸ‡¼", "Botswana");
    flags.insert("ğŸ‡§ğŸ‡¾", "Belarus");
    flags.insert("ğŸ‡§ğŸ‡¿", "Belize");
    flags.insert("ğŸ‡¨ğŸ‡¦", "Canada");
    flags.insert("ğŸ‡¨ğŸ‡¨", "Cocos (Keeling) Islands");
    flags.insert("ğŸ‡¨ğŸ‡©", "Congo - Kinshasa");
    flags.insert("ğŸ‡¨ğŸ‡«", "Central African Republic");
    flags.insert("ğŸ‡¨ğŸ‡¬", "Congo - Brazzaville");
    flags.insert("ğŸ‡¨ğŸ‡­", "Switzerland");
    flags.insert("ğŸ‡¨ğŸ‡®", "CÃ´te dâ€™Ivoire");
    flags.insert("ğŸ‡¨ğŸ‡°", "Cook Islands");
    flags.insert("ğŸ‡¨ğŸ‡±", "Chile");
    flags.insert("ğŸ‡¨ğŸ‡²", "Cameroon");
    flags.insert("ğŸ‡¨ğŸ‡³", "China");
    flags.insert("ğŸ‡¨ğŸ‡´", "Colombia");
    flags.insert("ğŸ‡¨ğŸ‡µ", "Clipperton Island");
    flags.insert("ğŸ‡¨ğŸ‡·", "Costa Rica");
    flags.insert("ğŸ‡¨ğŸ‡º", "Cuba");
    flags.insert("ğŸ‡¨ğŸ‡»", "Cape Verde");
    flags.insert("ğŸ‡¨ğŸ‡¼", "CuraÃ§ao");
    flags.insert("ğŸ‡¨ğŸ‡½", "Christmas Island");
    flags.insert("ğŸ‡¨ğŸ‡¾", "Cyprus");
    flags.insert("ğŸ‡¨ğŸ‡¿", "Czechia");
    flags.insert("ğŸ‡©ğŸ‡ª", "Germany");
    flags.insert("ğŸ‡©ğŸ‡¬", "Diego Garcia");
    flags.insert("ğŸ‡©ğŸ‡¯", "Djibouti");
    flags.insert("ğŸ‡©ğŸ‡°", "Denmark");
    flags.insert("ğŸ‡©ğŸ‡²", "Dominica");
    flags.insert("ğŸ‡©ğŸ‡´", "Dominican Republic");
    flags.insert("ğŸ‡©ğŸ‡¿", "Algeria");
    flags.insert("ğŸ‡ªğŸ‡¦", "Ceuta & Melilla");
    flags.insert("ğŸ‡ªğŸ‡¨", "Ecuador");
    flags.insert("ğŸ‡ªğŸ‡ª", "Estonia");
    flags.insert("ğŸ‡ªğŸ‡¬", "Egypt");
    flags.insert("ğŸ‡ªğŸ‡­", "Western Sahara");
    flags.insert("ğŸ‡ªğŸ‡·", "Eritrea");
    flags.insert("ğŸ‡ªğŸ‡¸", "Spain");
    flags.insert("ğŸ‡ªğŸ‡¹", "Ethiopia");
    flags.insert("ğŸ‡ªğŸ‡º", "European Union");
    flags.insert("ğŸ‡«ğŸ‡®", "Finland");
    flags.insert("ğŸ‡«ğŸ‡¯", "Fiji");
    flags.insert("ğŸ‡«ğŸ‡°", "Falkland Islands");
    flags.insert("ğŸ‡«ğŸ‡²", "Micronesia");
    flags.insert("ğŸ‡«ğŸ‡´", "Faroe Islands");
    flags.insert("ğŸ‡«ğŸ‡·", "France");
    flags.insert("ğŸ‡¬ğŸ‡¦", "Gabon");
    flags.insert("ğŸ‡¬ğŸ‡§", "United Kingdom");
    flags.insert("ğŸ‡¬ğŸ‡©", "Grenada");
    flags.insert("ğŸ‡¬ğŸ‡ª", "Georgia");
    flags.insert("ğŸ‡¬ğŸ‡«", "French Guiana");
    flags.insert("ğŸ‡¬ğŸ‡¬", "Guernsey");
    flags.insert("ğŸ‡¬ğŸ‡­", "Ghana");
    flags.insert("ğŸ‡¬ğŸ‡®", "Gibraltar");
    flags.insert("ğŸ‡¬ğŸ‡±", "Greenland");
    flags.insert("ğŸ‡¬ğŸ‡²", "Gambia");
    flags.insert("ğŸ‡¬ğŸ‡³", "Guinea");
    flags.insert("ğŸ‡¬ğŸ‡µ", "Guadeloupe");
    flags.insert("ğŸ‡¬ğŸ‡¶", "Equatorial Guinea");
    flags.insert("ğŸ‡¬ğŸ‡·", "Greece");
    flags.insert("ğŸ‡¬ğŸ‡¸", "South Georgia & South Sandwich Islands");
    flags.insert("ğŸ‡¬ğŸ‡¹", "Guatemala");
    flags.insert("ğŸ‡¬ğŸ‡º", "Guam");
    flags.insert("ğŸ‡¬ğŸ‡¼", "Guinea-Bissau");
    flags.insert("ğŸ‡¬ğŸ‡¾", "Guyana");
    flags.insert("ğŸ‡­ğŸ‡°", "Hong Kong SAR China");
    flags.insert("ğŸ‡­ğŸ‡²", "Heard & McDonald Islands");
    flags.insert("ğŸ‡­ğŸ‡³", "Honduras");
    flags.insert("ğŸ‡­ğŸ‡·", "Croatia");
    flags.insert("ğŸ‡­ğŸ‡¹", "Haiti");
    flags.insert("ğŸ‡­ğŸ‡º", "Hungary");
    flags.insert("ğŸ‡®ğŸ‡¨", "Canary Islands");
    flags.insert("ğŸ‡®ğŸ‡©", "Indonesia");
    flags.insert("ğŸ‡®ğŸ‡ª", "Ireland");
    flags.insert("ğŸ‡®ğŸ‡±", "Israel");
    flags.insert("ğŸ‡®ğŸ‡²", "Isle of Man");
    flags.insert("ğŸ‡®ğŸ‡³", "India");
    flags.insert("ğŸ‡®ğŸ‡´", "British Indian Ocean Territory");
    flags.insert("ğŸ‡®ğŸ‡¶", "Iraq");
    flags.insert("ğŸ‡®ğŸ‡·", "Iran");
    flags.insert("ğŸ‡®ğŸ‡¸", "Iceland");
    flags.insert("ğŸ‡®ğŸ‡¹", "Italy");
    flags.insert("ğŸ‡¯ğŸ‡ª", "Jersey");
    flags.insert("ğŸ‡¯ğŸ‡²", "Jamaica");
    flags.insert("ğŸ‡¯ğŸ‡´", "Jordan");
    flags.insert("ğŸ‡¯ğŸ‡µ", "Japan");
    flags.insert("ğŸ‡°ğŸ‡ª", "Kenya");
    flags.insert("ğŸ‡°ğŸ‡¬", "Kyrgyzstan");
    flags.insert("ğŸ‡°ğŸ‡­", "Cambodia");
    flags.insert("ğŸ‡°ğŸ‡®", "Kiribati");
    flags.insert("ğŸ‡°ğŸ‡²", "Comoros");
    flags.insert("ğŸ‡°ğŸ‡³", "St. Kitts & Nevis");
    flags.insert("ğŸ‡°ğŸ‡µ", "North Korea");
    flags.insert("ğŸ‡°ğŸ‡·", "South Korea");
    flags.insert("ğŸ‡°ğŸ‡¼", "Kuwait");
    flags.insert("ğŸ‡°ğŸ‡¾", "Cayman Islands");
    flags.insert("ğŸ‡°ğŸ‡¿", "Kazakhstan");
    flags.insert("ğŸ‡±ğŸ‡¦", "Laos");
    flags.insert("ğŸ‡±ğŸ‡§", "Lebanon");
    flags.insert("ğŸ‡±ğŸ‡¨", "St. Lucia");
    flags.insert("ğŸ‡±ğŸ‡®", "Liechtenstein");
    flags.insert("ğŸ‡±ğŸ‡°", "Sri Lanka");
    flags.insert("ğŸ‡±ğŸ‡·", "Liberia");
    flags.insert("ğŸ‡±ğŸ‡¸", "Lesotho");
    flags.insert("ğŸ‡±ğŸ‡¹", "Lithuania");
    flags.insert("ğŸ‡±ğŸ‡º", "Luxembourg");
    flags.insert("ğŸ‡±ğŸ‡»", "Latvia");
    flags.insert("ğŸ‡±ğŸ‡¾", "Libya");
    flags.insert("ğŸ‡²ğŸ‡¦", "Morocco");
    flags.insert("ğŸ‡²ğŸ‡¨", "Monaco");
    flags.insert("ğŸ‡²ğŸ‡©", "Moldova");
    flags.insert("ğŸ‡²ğŸ‡ª", "Montenegro");
    flags.insert("ğŸ‡²ğŸ‡«", "St. Martin");
    flags.insert("ğŸ‡²ğŸ‡¬", "Madagascar");
    flags.insert("ğŸ‡²ğŸ‡­", "Marshall Islands");
    flags.insert("ğŸ‡²ğŸ‡°", "Macedonia");
    flags.insert("ğŸ‡²ğŸ‡±", "Mali");
    flags.insert("ğŸ‡²ğŸ‡²", "Myanmar (Burma)");
    flags.insert("ğŸ‡²ğŸ‡³", "Mongolia");
    flags.insert("ğŸ‡²ğŸ‡´", "Macau Sar China");
    flags.insert("ğŸ‡²ğŸ‡µ", "Northern Mariana Islands");
    flags.insert("ğŸ‡²ğŸ‡¶", "Martinique");
    flags.insert("ğŸ‡²ğŸ‡·", "Mauritania");
    flags.insert("ğŸ‡²ğŸ‡¸", "Montserrat");
    flags.insert("ğŸ‡²ğŸ‡¹", "Malta");
    flags.insert("ğŸ‡²ğŸ‡º", "Mauritius");
    flags.insert("ğŸ‡²ğŸ‡»", "Maldives");
    flags.insert("ğŸ‡²ğŸ‡¼", "Malawi");
    flags.insert("ğŸ‡²ğŸ‡½", "Mexico");
    flags.insert("ğŸ‡²ğŸ‡¾", "Malaysia");
    flags.insert("ğŸ‡²ğŸ‡¿", "Mozambique");
    flags.insert("ğŸ‡³ğŸ‡¦", "Namibia");
    flags.insert("ğŸ‡³ğŸ‡¨", "New Caledonia");
    flags.insert("ğŸ‡³ğŸ‡ª", "Niger");
    flags.insert("ğŸ‡³ğŸ‡«", "Norfolk Island");
    flags.insert("ğŸ‡³ğŸ‡¬", "Nigeria");
    flags.insert("ğŸ‡³ğŸ‡®", "Nicaragua");
    flags.insert("ğŸ‡³ğŸ‡±", "Netherlands");
    flags.insert("ğŸ‡³ğŸ‡´", "Norway");
    flags.insert("ğŸ‡³ğŸ‡µ", "Nepal");
    flags.insert("ğŸ‡³ğŸ‡·", "Nauru");
    flags.insert("ğŸ‡³ğŸ‡º", "Niue");
    flags.insert("ğŸ‡³ğŸ‡¿", "New Zealand");
    flags.insert("ğŸ‡´ğŸ‡²", "Oman");
    flags.insert("ğŸ‡µğŸ‡¦", "Panama");
    flags.insert("ğŸ‡µğŸ‡ª", "Peru");
    flags.insert("ğŸ‡µğŸ‡«", "French Polynesia");
    flags.insert("ğŸ‡µğŸ‡¬", "Papua New Guinea");
    flags.insert("ğŸ‡µğŸ‡­", "Philippines");
    flags.insert("ğŸ‡µğŸ‡°", "Pakistan");
    flags.insert("ğŸ‡µğŸ‡±", "Poland");
    flags.insert("ğŸ‡µğŸ‡²", "St. Pierre & Miquelon");
    flags.insert("ğŸ‡µğŸ‡³", "Pitcairn Islands");
    flags.insert("ğŸ‡µğŸ‡·", "Puerto Rico");
    flags.insert("ğŸ‡µğŸ‡¸", "Palestinian Territories");
    flags.insert("ğŸ‡µğŸ‡¹", "Portugal");
    flags.insert("ğŸ‡µğŸ‡¼", "Palau");
    flags.insert("ğŸ‡µğŸ‡¾", "Paraguay");
    flags.insert("ğŸ‡¶ğŸ‡¦", "Qatar");
    flags.insert("ğŸ‡·ğŸ‡ª", "RÃ©union");
    flags.insert("ğŸ‡·ğŸ‡´", "Romania");
    flags.insert("ğŸ‡·ğŸ‡¸", "Serbia");
    flags.insert("ğŸ‡·ğŸ‡º", "Russia");
    flags.insert("ğŸ‡·ğŸ‡¼", "Rwanda");
    flags.insert("ğŸ‡¸ğŸ‡¦", "Saudi Arabia");
    flags.insert("ğŸ‡¸ğŸ‡§", "Solomon Islands");
    flags.insert("ğŸ‡¸ğŸ‡¨", "Seychelles");
    flags.insert("ğŸ‡¸ğŸ‡©", "Sudan");
    flags.insert("ğŸ‡¸ğŸ‡ª", "Sweden");
    flags.insert("ğŸ‡¸ğŸ‡¬", "Singapore");
    flags.insert("ğŸ‡¸ğŸ‡­", "St. Helena");
    flags.insert("ğŸ‡¸ğŸ‡®", "Slovenia");
    flags.insert("ğŸ‡¸ğŸ‡¯", "Svalbard & Jan Mayen");
    flags.insert("ğŸ‡¸ğŸ‡°", "Slovakia");
    flags.insert("ğŸ‡¸ğŸ‡±", "Sierra Leone");
    flags.insert("ğŸ‡¸ğŸ‡²", "San Marino");
    flags.insert("ğŸ‡¸ğŸ‡³", "Senegal");
    flags.insert("ğŸ‡¸ğŸ‡´", "Somalia");
    flags.insert("ğŸ‡¸ğŸ‡·", "Suriname");
    flags.insert("ğŸ‡¸ğŸ‡¸", "South Sudan");
    flags.insert("ğŸ‡¸ğŸ‡¹", "SÃ£o TomÃ© & PrÃ­ncipe");
    flags.insert("ğŸ‡¸ğŸ‡»", "El Salvador");
    flags.insert("ğŸ‡¸ğŸ‡½", "Sint Maarten");
    flags.insert("ğŸ‡¸ğŸ‡¾", "Syria");
    flags.insert("ğŸ‡¸ğŸ‡¿", "Swaziland");
    flags.insert("ğŸ‡¹ğŸ‡¦", "Tristan Da Cunha");
    flags.insert("ğŸ‡¹ğŸ‡¨", "Turks & Caicos Islands");
    flags.insert("ğŸ‡¹ğŸ‡©", "Chad");
    flags.insert("ğŸ‡¹ğŸ‡«", "French Southern Territories");
    flags.insert("ğŸ‡¹ğŸ‡¬", "Togo");
    flags.insert("ğŸ‡¹ğŸ‡­", "Thailand");
    flags.insert("ğŸ‡¹ğŸ‡¯", "Tajikistan");
    flags.insert("ğŸ‡¹ğŸ‡°", "Tokelau");
    flags.insert("ğŸ‡¹ğŸ‡±", "Timor-Leste");
    flags.insert("ğŸ‡¹ğŸ‡²", "Turkmenistan");
    flags.insert("ğŸ‡¹ğŸ‡³", "Tunisia");
    flags.insert("ğŸ‡¹ğŸ‡´", "Tonga");
    flags.insert("ğŸ‡¹ğŸ‡·", "Turkey");
    flags.insert("ğŸ‡¹ğŸ‡¹", "Trinidad & Tobago");
    flags.insert("ğŸ‡¹ğŸ‡»", "Tuvalu");
    flags.insert("ğŸ‡¹ğŸ‡¼", "Taiwan");
    flags.insert("ğŸ‡¹ğŸ‡¿", "Tanzania");
    flags.insert("ğŸ‡ºğŸ‡¦", "Ukraine");
    flags.insert("ğŸ‡ºğŸ‡¬", "Uganda");
    flags.insert("ğŸ‡ºğŸ‡²", "U.S. Outlying Islands");
    flags.insert("ğŸ‡ºğŸ‡³", "United Nations");
    flags.insert("ğŸ‡ºğŸ‡¸", "United States");
    flags.insert("ğŸ‡ºğŸ‡¾", "Uruguay");
    flags.insert("ğŸ‡ºğŸ‡¿", "Uzbekistan");
    flags.insert("ğŸ‡»ğŸ‡¦", "Vatican City");
    flags.insert("ğŸ‡»ğŸ‡¨", "St. Vincent & Grenadines");
    flags.insert("ğŸ‡»ğŸ‡ª", "Venezuela");
    flags.insert("ğŸ‡»ğŸ‡¬", "British Virgin Islands");
    flags.insert("ğŸ‡»ğŸ‡®", "U.S. Virgin Islands");
    flags.insert("ğŸ‡»ğŸ‡³", "Vietnam");
    flags.insert("ğŸ‡»ğŸ‡º", "Vanuatu");
    flags.insert("ğŸ‡¼ğŸ‡«", "Wallis & Futuna");
    flags.insert("ğŸ‡¼ğŸ‡¸", "Samoa");
    flags.insert("ğŸ‡½ğŸ‡°", "Kosovo");
    flags.insert("ğŸ‡¾ğŸ‡ª", "Yemen");
    flags.insert("ğŸ‡¾ğŸ‡¹", "Mayotte");
    flags.insert("ğŸ‡¿ğŸ‡¦", "South Africa");
    flags.insert("ğŸ‡¿ğŸ‡²", "Zambia");
    flags.insert("ğŸ‡¿ğŸ‡¼", "Zimbabwe");
    flags.insert("ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿", "England");
    flags.insert("ğŸ´ó §ó ¢ó ³ó £ó ´ó ¿", "Scotland");
    flags.insert("ğŸ´ó §ó ¢ó ·ó ¬ó ³ó ¿", "Wales");

    let mut f = HashMap::new();
    for (k, v) in flags.iter() {
        f.insert(v, k);
    }
    f.get(name);
}

fn main() {
    let args: Vec<String> = std::env::args().collect();
    let input = &args[1];
    let ip: IpAddr = FromStr::from_str(input).unwrap();

    let r = maxminddb::Reader::open_readfile(DB);
    if let Err(err) = r {
        panic!(format!("error opening mmdb: {:?}", err));
    }
    let record: geoip2::City = r.unwrap().lookup(ip).unwrap();
    println!("{:?}", record);
    println!("{}/{}", record.country.unwrap().names.unwrap().get("en").unwrap(), record.city.unwrap().names.unwrap().get("en").unwrap());
    flag("Japan");
}

